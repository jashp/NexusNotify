
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Nexus 4 Notifier</title>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
	<link href="static/css/bootstrap.min.css" rel="stylesheet">

 </head>

  <body>
		<div class="hero">
			<div class="aux">
				<div class="row">
					<div class="span6">
						<h2>
							Get notified when the Nexus 4 is back in stock!
						</h2>
						
						<p>
							With your favorite Google Apps, an amazing Photo Sphere camera, cutting edge
							hardware, and access to your favorite entertainment on Google Play â€“ Nexus 4 puts the
							best of Google in the palm of your hand.</p>
							
						<p>Now you don't have to worry about refreshing for hours on end to order it! This site will actually remember to email you when it's in stock (unlike a certain search engine company). </p>
						
						<legend>Sign up!</legend>
						<div id="info-success" class="alert alert-success hide"></div>
						<div id="info-error" class="alert alert-error hide"></div>
						<form id="register-form" class="form-horizontal">
							<div class="control-group">
								<label class="control-label" for="inputEmailId">Email</label>
								<div class="controls">
									{{ form.email(size=20) }}
								</div>
							</div>
					
							<div class="control-group">
								<label class="control-label" for="inputVersionId">Device(s)</label>
								<div class="controls">
									{{ form.versions }}
								</div>
							</div>
					
							<div class="control-group">
								<label class="control-label" for="inputLocationId">Location</label>
								<div class="controls">
									{{ form.location }}
								</div>
							</div>

							<div class="control-group">
								<label class="control-label" for="captcha">Captcha</label>
								<div class="controls">
									{% if not debug %}{{ form.recaptcha }}{% endif %}
								</div>
							</div>

							<div class="form-actions">  
								<button type="submit" class="btn btn-primary">Submit</button>  
							</div>  
						</form>
					</div>
					<div class="span6">
						<img alt="Nexus 4" src="/static/img/n4-product-hero.png">
					</div>
				</div>
				<a href="#unsubscribe-modal" role="button" data-toggle="modal">Unsubscribe</a>
			</div>
		</div>
		<div id="unsubscribe-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h3>Unsubsribe</h3>
			</div>
				<div class="modal-body">
					<div id="info-error-modal" class="alert alert-error hide"></div>
					<form id="unsubscribe-form" class="form-horizontal">
						<div class="control-group">
							<label class="control-label" for="inputEmailUnsubscribeId">Email</label>
							<div class="controls">
								<input type="text" id="inputEmailUnsubscribeId" name="inputEmail" placeholder="Email">
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button id="unsubscribe-submit" type="submit" class="btn btn-primary">Submit</button>  
					<button id="unsubscribe-cancel" class="btn" data-dismiss="modal">Cancel</button>  
				</div>
		</div>
	<script src="/static/js/bootstrap.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		function emailValid(email) {
			var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
			return regex.test(email);
		}
		function subscribeValid() {
			var valid = true;
			var errorMsg = "";
			var lineBreak = "\n";

			if (!emailValid($("#email").val())) {
				valid = false;
				errorMsg = errorMsg + "Please enter a valid email address." + lineBreak;
			}
			
			if (!($('#versions-0').prop('checked') || $('#versions-1').prop('checked') || $('#versions-2').prop('checked'))) {
				valid = false;
				errorMsg = errorMsg + "You must select at least one device." + lineBreak;
			}
			

			if (!valid) {
				showAlert($("#info-error"), errorMsg);
				return false;
			} else {
				return true;
			}		
		}		
		function showAlert(alertBox, message) {
			$(".alert").hide();
			alertBox.text(message);
			alertBox.show();
		}
		$("#register-form").submit(function(event){
			event.preventDefault();
			if (!subscribeValid()) {
				return;
			}
			var $form = $(this);
			$inputs = $form.find("input, select, button, textarea");
			var serializedData = $form.serialize();
			$inputs.attr("disabled", "disabled");
			ajaxRequest = $.ajax({
				url: "add",
				type: "post",
				data: serializedData,
				success: function(response, textStatus, jqXHR){
					showAlert($("#info-success"), "It worked! We'll let you know when the Nexus 4 is back in stock.");
					$form.hide();
				},
				error: function(jqXHR, textStatus, errorThrown){
					showAlert($("#info-error"), jqXHR.responseText);
					$inputs.removeAttr("disabled");
				},
			});
		});

		function unsubscribeValid() {
			if (!emailValid($("#inputEmailUnsubscribeId").val())) {
				showAlert($("#info-error-modal"), "Please enter a valid email address.");
				return false;
			} else {
				return true;
			}
		}


		$("#unsubscribe-submit").click(function(){
			$("#unsubscribe-form").submit();
		});
		
		$("#unsubscribe-cancel").click(function(){
			ajaxRequest.abort();
			$("#unsubscribe-form, #unsubscribe-submit").find("input, select, button, textarea").removeAttr("disabled");
		});
		$("#unsubscribe-form").submit(function(event){
			event.preventDefault();
			if (!unsubscribeValid()) {
				return;
			}
			$inputs = $("#unsubscribe-form, #unsubscribe-submit").find("input, select, button, textarea");
			var serializedData = $(this).serialize();
			$inputs.attr("disabled", "disabled");
			ajaxRequest = $.ajax({
				url: "unsubscribe",
				type: "post",
				data: serializedData,
				success: function(response, textStatus, jqXHR){
					$('#unsubscribe-modal').modal('hide');
					showAlert($("#info-success"), "It worked! You've been unsubscribed.");
					$inputs.removeAttr("disabled");
					
				},
				error: function(jqXHR, textStatus, errorThrown){
					showAlert($("#info-error-modal"), jqXHR.responseText);
					$inputs.removeAttr("disabled");
				},
			});
		});	
	</script>
  </body>
</html>
